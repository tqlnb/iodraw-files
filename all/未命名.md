```mermaid
graph TD
    %% --------------------------------------------------
    %% 定义流程图的三个主要分支
    %% --------------------------------------------------

    %% 分支 A: 操作员输入与软件联锁
    subgraph "A. 软件联锁 (阻止新请求)"
        direction TB
        A1[pbTreadleDown^ 踏板踩下(指针)] --> A2(pTreadleLocked 算法)
        A2 --> A3[mbTreadleLocked 内部锁定标志]
        
        A4[di_ButtonMoveUp/Down 物理按钮] --> A5(p...Button 按钮算法)
        A3 -- "NOT mbTreadleLocked" --> A5
        A5 --> A6[sv_bMoveUp/Down 软件运动请求]
    end

    %% 分支 B: 核心踏板监控 (安全核心)
    subgraph "B. 核心踏板监控 (持续运行)"
        direction TB
        B1[di_SafetyTreadle 物理踏板] --> B2(paElevatorTreadle 后台监控)
        B2 --> B3[sv_bSafetyTreadleNotOK 全局'危险'标志]
    end

    %% 分支 C: 电机输出与硬件联锁 (最终决策)
    subgraph "C. 硬件联锁 (直接切断电机)"
        direction TB
        %% 运动请求和危险标志汇入
        A6 --> C1(pElevatorUp/Down 电机输出算法)
        B3 -- "NOT sv_bSafetyTreadleNotOK" --> C1
        
        C1 --> C2[do_MoveUp/Down 最终电机输出]
    end

    %% 分支 D: 独立的报警联锁
    subgraph "D. 报警联锁 (独立)"
        direction TB
        B1 --> D1(pElevatorTreadleCheck 报警检查)
        D1 --> D2[erSafetyTreadleNotOK (发出报警)]
        D1 --> D3[fbLockUnlockGroup (触发全局互锁)]
    end
```